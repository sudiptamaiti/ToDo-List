<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - ToDo App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-[#e4e9fd] flex items-center justify-center min-h-screen">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-8">
    <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">Create Account</h2>

    <!-- Flash Error Message -->
    <% if (typeof error !== 'undefined' && error.length > 0) { %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mb-4">
        <%= error %>
      </div>
    <% } %>

    <form action="/register" method="POST" class="space-y-5" id="registerForm">

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
        <input 
          type="email" 
          id="email" 
          name="username" 
          required 
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none"
          placeholder="you@example.com"
        >
      </div>

      <!-- Password -->
      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
        <div class="relative">
          <input 
            type="password" 
            id="password" 
            name="password" 
            required 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none"
            placeholder="••••••••"
          >
          <i id="togglePassword" class="fa-solid fa-eye absolute right-3 top-3 cursor-pointer text-gray-500"></i>
        </div>
        <ul class="mt-2 text-sm hidden" id="passwordRules">
          <li id="lengthRule" class="text-red-500">❌ At least 8 characters</li>
          <li id="upperRule" class="text-red-500">❌ At least one uppercase letter</li>
          <li id="lowerRule" class="text-red-500">❌ At least one lowercase letter</li>
          <li id="numberRule" class="text-red-500">❌ At least one number</li>
          <li id="specialRule" class="text-red-500">❌ At least one special character</li>
        </ul>
      </div>

      <!-- Confirm Password -->
      <div>
        <label for="confirm_password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
        <div class="relative">
          <input 
            type="password" 
            id="confirm_password" 
            name="confirm_password" 
            required 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:outline-none"
            placeholder="••••••••"
          >
          <i id="toggleConfirm" class="fa-solid fa-eye absolute right-3 top-3 cursor-pointer text-gray-500"></i>
        </div>
        <p id="confirmMessage" class="text-sm mt-1 text-red-500 hidden">❌ Passwords do not match</p>
      </div>

      <!-- Submit Button -->
      <button 
        type="submit" 
        id="submitBtn"
        disabled
        class="w-full bg-[#a683e3] cursor-not-allowed hover:bg-[#7247bd] text-white font-medium py-2 rounded-lg transition duration-200"
      >
        Sign Up
      </button>
    </form>

    <!-- Link to Login -->
    <p class="text-center text-sm text-gray-600 mt-6">
      Already have an account? 
      <a href="/login" class="text-indigo-600 hover:underline">Log in</a>
    </p>
  </div>

  <!-- Validation Script -->
  <script>
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirm_password");
    const passwordRules = document.getElementById("passwordRules");
    const confirmMessage = document.getElementById("confirmMessage");
    const submitBtn = document.getElementById("submitBtn");

    // Rules
    const lengthRule = document.getElementById("lengthRule");
    const upperRule = document.getElementById("upperRule");
    const lowerRule = document.getElementById("lowerRule");
    const numberRule = document.getElementById("numberRule");
    const specialRule = document.getElementById("specialRule");

    // Toggle Password Visibility
    const togglePassword = document.getElementById("togglePassword");
    const toggleConfirm = document.getElementById("toggleConfirm");

    togglePassword.addEventListener("click", () => {
      const isPassword = password.type === "password";
      password.type = isPassword ? "text" : "password";

      togglePassword.classList.toggle("fa-eye");
      togglePassword.classList.toggle("fa-eye-slash");
    });

    toggleConfirm.addEventListener("click", () => {
      const isPassword = confirmPassword.type === "password";
      confirmPassword.type = isPassword ? "text" : "password";

      toggleConfirm.classList.toggle("fa-eye");
      toggleConfirm.classList.toggle("fa-eye-slash");
    });

    function validatePassword() {
      const value = password.value;
      let valid = true;

      if (value.length > 0) {
        passwordRules.classList.remove("hidden");
      } else {
        passwordRules.classList.add("hidden");
      }

      const lengthCheck = value.length >= 8;
      const upperCheck = /[A-Z]/.test(value);
      const lowerCheck = /[a-z]/.test(value);
      const numberCheck = /[0-9]/.test(value);
      const specialCheck = /[!@#$%^&*(),.?":{}|<>]/.test(value);

      updateRule(lengthRule, lengthCheck, "At least 8 characters");
      updateRule(upperRule, upperCheck, "At least one uppercase letter");
      updateRule(lowerRule, lowerCheck, "At least one lowercase letter");
      updateRule(numberRule, numberCheck, "At least one number");
      updateRule(specialRule, specialCheck, "At least one special character");

      valid = lengthCheck && upperCheck && lowerCheck && numberCheck && specialCheck;

      password.classList.remove("border-green-500", "border-red-500");
      if (value.length > 0) {
        password.classList.add(valid ? "border-green-500" : "border-red-500");
      }

      return valid;
    }

    function updateRule(element, condition, text) {
      if (condition) {
        element.classList.add("hidden");
      } else {
        element.classList.remove("hidden");
        element.textContent = "❌ " + text;
      }
    }

    function validateConfirm() {
      const val = confirmPassword.value;
      const match = val.length > 0 && val === password.value;

      confirmPassword.classList.remove("border-green-500", "border-red-500");

      if (val.length === 0) {
        confirmMessage.classList.add("hidden");
      } else if (match) {
        confirmPassword.classList.add("border-green-500");
        confirmMessage.classList.add("hidden");
      } else {
        confirmPassword.classList.add("border-red-500");
        confirmMessage.classList.remove("hidden");
      }

      return match;
    }

    function validateForm() {
      const passValid = validatePassword();
      const confirmValid = validateConfirm();

      if (passValid && confirmValid) {
        submitBtn.disabled = false;
        submitBtn.classList.remove("bg-indigo-400", "cursor-not-allowed");
        submitBtn.classList.add("bg-indigo-600", "hover:bg-indigo-700");
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.add("bg-indigo-400", "cursor-not-allowed");
        submitBtn.classList.remove("bg-indigo-600", "hover:bg-indigo-700");
      }
    }

    password.addEventListener("input", validateForm);
    confirmPassword.addEventListener("input", validateForm);
  </script>
</body>
</html>